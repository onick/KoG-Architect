# KOG Monorepo Principal Architect

**Claude Code + Cursor IDE Plugin** — Principal Staff Engineer + Real-Time Systems Architect para monorepos de juegos de ajedrez en tiempo real (NestJS + Next.js + Redis/Socket.IO).

Compatible con **Claude Code** y **Cursor IDE**.

## Que hace

Orquesta, estabiliza y escala un ecosistema de microservicios enfocado en gameplay de alta concurrencia, motores de ajedrez y sistemas anti-trampas. Mantiene estado persistente en `.kog-architect/`.

### Tres sombreros

- **Real-Time Systems Architect** — Sub-100ms latency, horizontal scaling, WebSocket resilience
- **Security & Anti-Cheat Engineer** — Authoritative backend, JWT guards, Stockfish/Lc0 pipelines
- **Monorepo Discipline Officer** — Shared types, consistent testing, clean module boundaries

## Installation

### Claude Code

```bash
/plugin marketplace add onick/KoG-Architect
```

Then run `/plugin menu` to install. Restart Claude Code after.

### Cursor IDE

1. Clone or download this repo
2. Copy the Cursor-specific directories into your project:

```bash
# Option A: Copy into your project root
cp -r .cursor-plugin/ /path/to/your-project/
cp -r skills/ /path/to/your-project/.cursor/skills/
cp -r agents/ /path/to/your-project/.cursor/agents/
cp -r rules/ /path/to/your-project/.cursor/rules/
cp -r commands/ /path/to/your-project/.cursor/commands/
```

```bash
# Option B: Symlink for auto-updates
ln -s /path/to/KoG-Architect/rules/ /path/to/your-project/.cursor/rules
ln -s /path/to/KoG-Architect/agents/ /path/to/your-project/.cursor/agents
ln -s /path/to/KoG-Architect/commands/ /path/to/your-project/.cursor/commands
```

3. Restart Cursor IDE

> **Cursor rules** (`.mdc` files) are automatically loaded when matching file globs are detected. All 7 guardrails are enforced as always-on rules.

## Commands

| Command | Purpose |
|---------|---------|
| `/kog-init` | Bootstrap: scan monorepo, generate `.kog-architect/` state |
| `/kog-status` | Dashboard: services health, phase progress, debt summary |
| `/kog-phase` | Manage phases: view current, advance, or plan next |
| `/kog-audit` | Full architecture audit (7 dimensions, score /35) |
| `/kog-delegate` | Generate precise agent delegation for a task |
| `/kog-test` | Test coverage analysis and gap detection |
| `/kog-incident` | Log, analyze, and post-mortem production incidents |
| `/kog-sync` | Sync `.kog-architect/` vs actual codebase |

## 5 Specialized Agents

| Agent | Domain |
|-------|--------|
| **nestjs-backend** | NestJS modules, DI, DTOs, Prisma, health checks |
| **realtime-game** | game-engine, clock-service, websocket-gateway, Redis atomics |
| **anticheat-queues** | Stockfish/Lc0 workers, Bull queues, circuit breakers |
| **nextjs-frontend** | Next.js 15 App Router, Socket.IO client, shared types |
| **devops-sre** | Docker, K8s, GitHub Actions, probes, monitoring |

## 7 Non-Negotiable Guardrails

| # | Guardrail | Cursor Rule |
|---|-----------|-------------|
| G1 | **Backend is Authoritative** — Server validates all moves | `rules/backend-authoritative.mdc` |
| G2 | **Database Polyglot** — CockroachDB + MongoDB + Redis | `rules/database-boundaries.mdc` |
| G3 | **Async by Default** — Bull Queues for CPU work | `rules/async-event-loop.mdc` |
| G4 | **Minimal WebSocket Payloads** — Deltas only | `rules/websocket-payloads.mdc` |
| G5 | **No Feature Without Tests** — Every file gets .spec.ts | `rules/mandatory-tests.mdc` |
| G6 | **Circuit Breakers** — Cross-service fallbacks | `rules/circuit-breakers.mdc` |
| G7 | **Single Source of Truth for Types** — Shared packages | `rules/shared-types.mdc` |

## 4-Phase Stabilization Roadmap

| Phase | Goal | Exit Criteria |
|-------|------|--------------|
| 1. Core Coverage & Security Seal | Prevent production collapse | 80% test coverage on critical services, zero auth bypass |
| 2. Fix Broken Architecture | Repair disconnected data flows | All services boot, queues have retry + DLQ |
| 3. Real-Time Optimization | Support 5K+ concurrent connections | Reconnection works, clock drift < 50ms |
| 4. Frontend Sync & API Gateway | Efficient client-server communication | Zero direct backend calls, rate limiting active |

## Persistent State

Generated by `/kog-init` in your project root:

```
.kog-architect/
  services-registry.md      # Service health, coverage, dependencies
  phase-tracker.md           # Current phase with checkboxes
  debt-register.md           # Tech debt with severity and deadlines
  test-coverage.md           # Per-service test tracking
  incident-log.md            # Production incidents and post-mortems
  architecture-decisions.md  # ADRs (Architecture Decision Records)
```

## Stack

- **Runtime:** Node.js >= 18, TypeScript strict
- **Backend:** NestJS (modular microservices)
- **Frontend:** Next.js 15, React 18, Tailwind
- **Real-Time:** Socket.IO + Redis Adapter
- **Databases:** Redis, CockroachDB (Prisma), MongoDB
- **Queues:** Bull (Redis-backed)
- **Chess:** chess.js, Stockfish, Lc0
- **Infra:** Docker, Kubernetes, GitHub Actions

## Repository Structure

```
KoG-Architect/
├── .claude-plugin/              # Claude Code plugin metadata
│   ├── plugin.json
│   └── marketplace.json
├── .claude/                     # Claude Code specific
│   ├── commands/                #   8 slash commands
│   └── skills/
│       └── kog-monorepo-architect/
│           ├── SKILL.md         #   Main brain
│           ├── agents/          #   5 agent templates
│           └── references/      #   8 reference docs
│
├── .cursor-plugin/              # Cursor IDE plugin metadata
│   ├── plugin.json
│   └── marketplace.json
├── skills/                      # Cursor: skill + references
│   └── kog-monorepo-architect/
│       ├── SKILL.md
│       └── references/
├── agents/                      # Cursor: 5 agents (YAML frontmatter)
├── commands/                    # Cursor: 8 commands (YAML frontmatter)
├── rules/                       # Cursor: 7 .mdc guardrail rules
│
├── LICENSE
└── README.md
```

## Compatibility

| Feature | Claude Code | Cursor IDE |
|---------|-------------|------------|
| Skill (SKILL.md) | `.claude/skills/` | `skills/` + YAML frontmatter |
| Commands | `.claude/commands/` | `commands/` + YAML frontmatter |
| Agents | `.claude/skills/*/agents/` | `agents/` + YAML frontmatter |
| Rules/Guardrails | Embedded in SKILL.md | `rules/*.mdc` (auto-loaded) |
| References | `.claude/skills/*/references/` | `skills/*/references/` |
| Plugin metadata | `.claude-plugin/` | `.cursor-plugin/` |

## License

MIT

---

Creado por [Contan2](https://contan2.com)
